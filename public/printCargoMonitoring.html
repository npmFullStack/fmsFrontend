<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cargo Monitoring Report</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            padding: 20px;
        }
        
        .table-container {
            width: 100%;
            background-color: white;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }
        
        .table-title {
            background-color: #1e3a8a;
            color: white;
            font-weight: bold;
            text-align: center;
            font-size: 20px;
            padding: 12px;
            text-transform: uppercase;
            border: 2px solid #000;
        }
        
        th {
            background-color: #7e4200;
            color: #fff;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 9px;
            padding: 6px 4px;
            text-align: left;
            border-right: 1px solid #ff9d0c;
            height: 15px;
            text-align: center;
            border-bottom: 2px solid #00c400;
        }
        
        th:last-child {
            border-right: none;
        }
        
        td {
            padding: 4px 4px;
            border-bottom: 1px solid #e0e0e0;
            font-size: 8px;
            text-transform: uppercase;
            height: 25px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            text-align: center;
            vertical-align: top;
        }
        
        .date-cell {
            font-weight: bold;
            color: #1e3a8a;
        }
        
        .status-delivered {
            background-color: #dcfce7;
            font-weight: bold;
        }
        
        .status-in-transit {
            background-color: #fef3c7;
        }
        
        .status-pending {
            background-color: #f3f4f6;
        }

        /* Column width adjustments - removed status and empty container columns */
        th:nth-child(1), td:nth-child(1) { width: 9%; }
        th:nth-child(2), td:nth-child(2) { width: 11%; }
        th:nth-child(3), td:nth-child(3) { width: 8%; }
        th:nth-child(4), td:nth-child(4) { width: 8%; }
        th:nth-child(5), td:nth-child(5) { width: 11%; }
        th:nth-child(6), td:nth-child(6) { width: 9%; }
        th:nth-child(7), td:nth-child(7) { width: 9%; }
        th:nth-child(8), td:nth-child(8) { width: 8%; }
        th:nth-child(9), td:nth-child(9) { width: 9%; }
        th:nth-child(10), td:nth-child(10) { width: 9%; }
        th:nth-child(11), td:nth-child(11) { width: 9%; }
        th:nth-child(12), td:nth-child(12) { width: 7%; }
        th:nth-child(13), td:nth-child(13) { width: 7%; }
        th:nth-child(14), td:nth-child(14) { width: 9%; }
        th:nth-child(15), td:nth-child(15) { width: 8%; }

        .print-info {
            margin: 10px 0;
            font-size: 12px;
            color: #666;
        }

        @media print {
            body {
                background: white;
                padding: 0;
                margin: 0;
            }
            .table-container {
                box-shadow: none;
            }
        }
    </style>
</head>
<body>
    <div class="print-info">
        Generated on: <span id="printDate"></span> | 
        Records: <span id="recordCount">0</span>
    </div>
    
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <td colspan="15" class="table-title" id="tableTitle">Cargo Monitoring</td>
                </tr>
                <tr id="tableHeaders">
                    <!-- Headers will be populated by JavaScript -->
                </tr>
            </thead>
            <tbody id="tableBody">
                <!-- Data will be populated by JavaScript -->
            </tbody>
        </table>
    </div>

    <script>
        // Dynamic headers based on status - removed status and empty container columns
        const statusHeaders = {
            'Delivered': ['HWB No.', 'Shipper', 'Stuffing Date', 'Container Size', 'Commodity', 'Shipping Line', 
                         'Booking #', 'Van #', 'Pick Up Point', 'Destination', 'Mode of Service', 
                         'ATD', 'ATA', 'Trucker Dest.', 'Delivery Date'],
            'In Transit': ['HWB No.', 'Shipper', 'Stuffing Date', 'Container Size', 'Commodity', 'Shipping Line', 
                          'Booking #', 'Van #', 'Pick Up Point', 'Destination', 'Mode of Service', 
                          'ETD', 'ETA', 'Trucker Dest.', 'Estimated Delivery'],
            'default': ['HWB No.', 'Shipper', 'Stuffing Date', 'Container Size', 'Commodity', 'Shipping Line', 
                       'Booking #', 'Van #', 'Pick Up Point', 'Destination', 'Mode of Service', 
                       'ETD', 'ETA', 'Trucker Dest.', 'Estimated Delivery']
        };

        // Get title based on date filter
        function getTableTitle(dateFilter) {
            const now = new Date();
            const titles = {
                'all': 'Cargo Monitoring',
                'today': `Cargo Monitoring - ${now.toLocaleDateString()}`,
                'month': `Cargo Monitoring - ${now.toLocaleDateString('en', { month: 'long', year: 'numeric' })}`,
                'year': `Cargo Monitoring - ${now.getFullYear()}`
            };
            return titles[dateFilter] || titles['all'];
        }

        function formatDateTime(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return '<span class="date-cell">' + date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) + '</span>';
            } catch (e) {
                return 'N/A';
            }
        }

        function formatDateOnly(dateString) {
            if (!dateString) return 'N/A';
            try {
                const date = new Date(dateString);
                return '<span class="date-cell">' + date.toLocaleDateString() + '</span>';
            } catch (e) {
                return 'N/A';
            }
        }

        function populateTable() {
            const urlParams = new URLSearchParams(window.location.search);
            const dataParam = urlParams.get('data');
            const multipleParam = urlParams.get('multiple');
            
            if (dataParam) {
                try {
                    const data = JSON.parse(decodeURIComponent(dataParam));
                    const printDate = new Date().toLocaleString();
                    
                    document.getElementById('printDate').textContent = printDate;
                    
                    // Handle single or multiple records
                    const records = multipleParam === 'true' ? data : [data];
                    document.getElementById('recordCount').textContent = records.length;
                    
                    // Set table title based on date filter
                    const dateFilter = records[0]?.dateFilter || 'all';
                    document.getElementById('tableTitle').textContent = getTableTitle(dateFilter);
                    
                    // Set headers based on first record's status
                    const status = records[0]?.status || 'default';
                    const headers = statusHeaders[status] || statusHeaders.default;
                    const headerRow = document.getElementById('tableHeaders');
                    
                    headerRow.innerHTML = headers.map(header => 
                        `<th>${header}</th>`
                    ).join('');
                    
                    // Populate table body with all records
                    const tableBody = document.getElementById('tableBody');
                    tableBody.innerHTML = '';
                    
                    records.forEach((record, index) => {
                        const row = document.createElement('tr');
                        
                        // Add status class for styling
                        if (record.status) {
                            row.className = `status-${record.status.toLowerCase().replace(' ', '-')}`;
                        }
                        
                        // Add alternating row background for better readability
                        if (index % 2 === 0) {
                            row.style.backgroundColor = '#f8f9fa';
                        }
                        
                        row.innerHTML = `
                            <td>${record.hwbNumber || 'N/A'}</td>
                            <td>${record.shipper || 'N/A'}</td>
                            <td>${formatDateTime(record.stuffingDate)}</td>
                            <td>${record.containerSize || 'N/A'}</td>
                            <td>${record.commodity || 'N/A'}</td>
                            <td>${record.shippingLine || 'N/A'}</td>
                            <td>${record.bookingNumber || 'N/A'}</td>
                            <td>${record.vanNumber || 'N/A'}</td>
                            <td>${record.pickupPoint || 'N/A'}</td>
                            <td>${record.destination || 'N/A'}</td>
                            <td>${record.modeOfService || 'N/A'}</td>
                            <td>${formatDateTime(record.atd)}</td>
                            <td>${formatDateTime(record.ata)}</td>
                            <td>${record.truckerDest || 'N/A'}</td>
                            <td>${formatDateOnly(record.deliveryDate)}</td>
                        `;
                        
                        tableBody.appendChild(row);
                    });
                    
                    // Auto-print after loading
                    setTimeout(() => {
                        window.print();
                    }, 500);
                    
                } catch (error) {
                    console.error('Error parsing data:', error);
                    document.body.innerHTML = '<div style="text-align: center; padding: 50px; font-size: 16px;">Error loading cargo monitoring data</div>';
                }
            } else {
                document.body.innerHTML = '<div style="text-align: center; padding: 50px; font-size: 16px;">No data provided for printing</div>';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', populateTable);
    </script>
</body>
</html>